<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Louer des brebis - Artzainak</title>
    
    <!-- Métadonnées SEO -->
    <meta name="description" content="Service d'écopâturage au Pays Basque. Location de brebis pour entretien écologique de vos terrains. Devis personnalisé et service clé en main.">
    
    <!-- Balises Open Graph pour les réseaux sociaux -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Écopâturage par location de brebis - Artzainak">
    <meta property="og:description" content="Entretenez vos espaces verts de façon naturelle et écologique avec nos brebis. Service d'écopâturage professionnel au Pays Basque.">
    <meta property="og:image" content="https://artzainak.netlify.app/images/og-image-ecopaturage.jpg">
    <meta property="og:url" content="https://artzainak.netlify.app/location.html">
    <meta property="og:site_name" content="Artzainak">
    
    <!-- Balises de langue et canonical -->
    <link rel="alternate" hreflang="fr" href="https://artzainak.netlify.app/location.html">
    <link rel="canonical" href="https://artzainak.netlify.app/location.html">
    
    <!-- Google Tag Manager -->
    <script src="js/marketing-tracking.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            dark: '#4A49B0'
                        },
                        basque: {
                            red: '#DC3545',
                            green: '#198754'
                        }
                    }
                }
            }
        }
    </script>
    
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Styles spécifiques à cette page -->
    <style>
        /* Styles pour les éléments de l'iframe Cal.com */
        .cal-iframe-container {
            position: relative;
            width: 100%;
            height: 1200px;
            min-height: 1200px;
            margin: 20px 0;
            border: 1px solid rgba(25, 135, 84, 0.3);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .cal-iframe-container iframe {
            width: 100%;
            height: 100%;
            min-height: 1200px;
            border: none;
        }
        
        /* Style du loader */
        .iframe-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(26, 32, 44, 0.8);
            z-index: 10;
            border-radius: 8px;
            transition: opacity 0.3s ease;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid rgba(25, 135, 84, 0.3);
            border-radius: 50%;
            border-top-color: #198754;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Animation pour les résultats du calculateur */
        .calculation-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* Styles pour les FAQ */
        .faq-toggle:focus {
            outline: 2px solid rgba(25, 135, 84, 0.5);
            outline-offset: 2px;
        }
        
        /* Améliorations d'accessibilité */
        .high-contrast-text {
            color: #ffffff;
            text-shadow: 0 0 1px rgba(0,0,0,0.5);
        }
        
        .focus-visible:focus-visible {
            outline: 2px solid #198754;
            outline-offset: 2px;
        }
        
        /* Animations */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Adaptation pour mobile */
        @media (max-width: 640px) {
            .cal-iframe-container {
                height: 1400px;
                min-height: 1400px;
            }
            
            .cal-iframe-container iframe {
                min-height: 1400px;
            }
            
            #calculationResult {
                font-size: 0.85rem;
            }
            
            .loading-spinner {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Header -->
    <header class="bg-primary p-4 text-white sticky top-0 z-10 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <a href="index.html" class="text-xl font-bold">ARTZAINAK</a>
            <p class="text-sm hidden sm:block">Éducation de chiens de troupeau au Pays Basque</p>
            <button id="menuToggle" class="md:hidden focus:outline-none" aria-label="Menu principal" aria-expanded="false" aria-controls="mobileNav">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <nav id="mainNav" class="hidden md:block">
                <ul class="flex space-x-4">
                    <li><a href="index.html" class="hover:underline">Accueil</a></li>
                    <li><a href="#services" class="hover:underline">Services</a></li>
                    <li><a href="reservation.html" class="hover:underline">Formation</a></li>
                    <li><a href="location.html" class="hover:underline">Ecopaturage</a></li>
                    <li><a href="evaluation.html" class="hover:underline">Evaluation</a></li>
                    <li><a href="ressources.html" class="hover:underline">Ressources</a></li>
                    <li><a href="contact.html" class="hover:underline">Contact</a></li>
                </ul>
            </nav>
        </div>
        <nav id="mobileNav" class="hidden bg-primary-dark py-2 px-4">
            <ul class="space-y-2">
                <li><a href="index.html" class="hover:underline">Accueil</a></li>
                    <li><a href="#services" class="hover:underline">Services</a></li>
                    <li><a href="reservation.html" class="hover:underline">Formation</a></li>
                    <li><a href="location.html" class="hover:underline">Ecopaturage</a></li>
                    <li><a href="evaluation.html" class="hover:underline">Evaluation</a></li>
                    <li><a href="ressources.html" class="hover:underline">Ressources</a></li>
                    <li><a href="contact.html" class="hover:underline">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Page Title -->
    <div class="bg-basque-green/10 dark:bg-basque-green/20 py-6">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center">Location de brebis pour écopâturage</h1>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <!-- Introduction -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4">Entretenez vos espaces verts naturellement</h2>
                <p class="mb-4">L'écopâturage est une solution écologique et économique pour l'entretien de vos terrains. Nos brebis de race Manex débroussaillent efficacement tout en fertilisant naturellement votre sol.</p>
                
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <h3 class="font-semibold mb-2">Avantages de l'écopâturage :</h3>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>Solution 100% écologique sans produits chimiques</li>
                        <li>Entretien régulier et fertilisation naturelle du sol</li>
                        <li>Préservation de la biodiversité locale</li>
                        <li>Débroussaillage efficace même sur terrains difficiles</li>
                        <li>Alternative économique aux méthodes mécaniques</li>
                    </ul>
                </div>
            </div>
            
            <!-- Photo Gallery -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold mb-4">L'écopâturage en images</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <div class="aspect-video rounded overflow-hidden">
                        <img src="images/sheep1.jpg" alt="Brebis en écopâturage" class="w-full h-full object-cover">
                    </div>
                    <div class="aspect-video rounded overflow-hidden">
                        <img src="images/sheep2.jpg" alt="Tonte naturelle" class="w-full h-full object-cover">
                    </div>
                    <div class="aspect-video rounded overflow-hidden">
                        <img src="images/sheep3.jpg" alt="Entretien écologique" class="w-full h-full object-cover">
                    </div>
                </div>
            </div>
            
            <!-- Calculateur amélioré -->
            <div class="mb-8 p-4 bg-basque-green/5 dark:bg-basque-green/10 rounded-lg">
                <h3 class="font-semibold mb-3 flex items-center">
                    Calculateur d'écopâturage
                    <button id="helpCalculator" class="ml-2 text-xs bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-full w-5 h-5 inline-flex items-center justify-center focus-visible" aria-label="Aide sur le calculateur">?</button>
                </h3>
                <p class="mb-4 text-sm">Estimez le nombre de brebis nécessaires et le coût pour une semaine d'écopâturage sur votre terrain :</p>
                
                <div class="space-y-4">
                    <div>
                        <label for="landSize" class="block mb-1 font-medium text-sm">Surface de votre terrain (m²)</label>
                        <input type="number" id="landSize" min="2000" value="2000" 
                            class="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                            aria-describedby="sizeError">
                        <p id="sizeError" class="text-basque-red text-xs mt-1 hidden">La surface minimum est de 2000m²</p>
                    </div>
                    
                    <div>
                        <label for="address" class="block mb-1 font-medium text-sm">Adresse du terrain</label>
                        <input type="text" id="address" placeholder="Ex: 10 rue des Fleurs, 64200 Biarritz"
                            class="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <p id="distanceMessage" class="text-xs mt-1 italic">Nous calculerons automatiquement la distance depuis Arbonne.</p>
                    </div>
                    
                    <div>
                        <label for="terrain" class="block mb-1 font-medium text-sm">Type de terrain</label>
                        <select id="terrain" class="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="friche">Friche/Forêt (Valeur fourragère basse)</option>
                            <option value="jardin" selected>Pelouse/Jardin (Valeur fourragère moyenne)</option>
                            <option value="prairie">Prairie (Valeur fourragère élevée)</option>
                        </select>
                    </div>
                    
                    <button id="calculateBtn" class="bg-basque-green hover:bg-basque-green/80 text-white font-medium py-2 px-4 rounded transition duration-300 text-sm focus-visible">
                        Calculer
                    </button>
                </div>
                
                <div id="calculationResult" class="hidden mt-4 p-4 bg-gray-100 dark:bg-gray-600 rounded-lg text-sm">
                    <div id="loadingDistance" class="mb-2 text-xs flex items-center">
                        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-basque-green" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Calcul de la distance en cours...
                    </div>
                    <p class="mb-1">Surface à entretenir: <span id="areaSummary" class="font-medium">0</span> m²</p>
                    <p class="mb-1">Type de terrain: <span id="terrainTypeSummary" class="font-medium">Pelouse/Jardin</span></p>
                    <p class="mb-1">Nombre de brebis recommandé: <span id="sheepCount" class="font-medium">0</span></p>
                    <p class="mb-1">Durée de la prestation: <span class="font-medium">1 semaine</span></p>
                    <p class="mb-1">Distance depuis Arbonne: <span id="distanceSummary" class="font-medium">0</span> km</p>
                    <p id="distanceWarning" class="text-xs text-yellow-600 dark:text-yellow-400 mt-1 hidden">Distance non déterminée. Le prix peut varier en fonction de la localisation exacte.</p>
                    <p class="font-bold mt-2 text-base">Estimation du tarif: <span id="totalPrice">0</span> € / semaine</p>
                    <p class="mt-1 text-xs italic">Forfait hebdomadaire incluant livraison, installation et suivi des animaux</p>
                    
                    <!-- Impact écologique -->
                    <div id="eco-impact" class="mt-4 p-3 bg-basque-green/10 rounded-lg text-sm hidden">
                        <h4 class="font-semibold mb-2">Impact écologique estimé :</h4>
                        <div class="space-y-1">
                            <p class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-basque-green mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Économie de ~<span id="co2Savings">0</span> kg de CO2 vs. tonte mécanique</span>
                            </p>
                            <p class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-basque-green mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Économie de ~<span id="waterSavings">0</span> litres d'eau</span>
                            </p>
                            <p class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-basque-green mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Favorise la biodiversité locale</span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Bouton de réservation après calcul -->
                <div id="booking-btn-container" class="mt-4 hidden">
                    <a href="#calendar-section" class="block text-center bg-basque-green hover:bg-basque-green/80 text-white font-bold py-3 px-6 rounded-lg transition duration-300 focus-visible">
                        Réserver pour une semaine
                    </a>
                </div>
            </div>
            
            <!-- Section calendrier pour réservation -->
            <div id="calendar-section" class="mb-8 p-6 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-lg">
                <h3 class="text-xl font-semibold mb-4 text-center">Réserver des brebis à la semaine</h3>
                <p class="mb-6 text-center">Sélectionnez une date de début pour votre location hebdomadaire. Le formulaire est à remplir directement dans le calendrier.</p>
                
                <div class="cal-iframe-container">
                    <div id="loading-calendar" class="iframe-loading">
                        <div class="loading-spinner mb-4"></div>
                        <p>Chargement du calendrier...</p>
                    </div>
                    <iframe 
                        id="cal-iframe-ecopaturage"
                        src="https://cal.com/artzainak/sheep-week?embed=true&theme=dark&lang=fr&hideEventTypeDetails=false&embedType=responsive" 
                        width="100%" 
                        height="100%" 
                        frameborder="0"
                        allow="camera; microphone; autoplay; fullscreen"
                        onload="hideLoading('loading-calendar')">
                    </iframe>
                </div>
                <p class="mt-4 text-sm text-center text-gray-500 dark:text-gray-400">Vous serez contacté après votre réservation pour confirmer les détails et organiser l'installation des brebis.</p>
            </div>
            
            <!-- FAQ Section -->
            <div class="mb-8 p-6 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-lg">
                <h3 class="text-xl font-semibold mb-4 text-center">Questions fréquentes</h3>
                
                <div class="space-y-4">
                    <div class="border border-gray-200 dark:border-gray-600 rounded-lg overflow-hidden">
                        <button class="faq-toggle w-full flex justify-between items-center p-3 text-left font-medium" aria-expanded="false" aria-controls="faq-content-1">
                            <span>Quelle surface minimale est nécessaire pour l'écopâturage ?</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform transition-transform" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="faq-content-1" class="faq-content hidden p-3 pt-0">
                            <p>Pour un service d'écopâturage efficace avec nos brebis Manex, nous recommandons une surface minimale de 2000 m². Cette surface permet d'avoir suffisamment d'espace pour que les brebis puissent se déplacer et s'alimenter correctement.</p>
                        </div>
                    </div>
                    
                    <div class="border border-gray-200 dark:border-gray-600 rounded-lg overflow-hidden">
                        <button class="faq-toggle w-full flex justify-between items-center p-3 text-left font-medium" aria-expanded="false" aria-controls="faq-content-2">
                            <span>Comment se déroule l'installation des brebis ?</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform transition-transform" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="faq-content-2" class="faq-content hidden p-3 pt-0">
                            <p>Notre service comprend l'installation complète : nous livrons les brebis, mettons en place les clôtures électriques temporaires si nécessaire, installons un abri et un abreuvoir. Nous effectuons également un suivi régulier pour vérifier le bien-être des animaux et l'avancement du travail d'entretien.</p>
                        </div>
                    </div>
                    
                    <div class="border border-gray-200 dark:border-gray-600 rounded-lg overflow-hidden">
                        <button class="faq-toggle w-full flex justify-between items-center p-3 text-left font-medium" aria-expanded="false" aria-controls="faq-content-3">
                            <span>Quelle est l'efficacité des brebis selon le type de terrain ?</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform transition-transform" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="faq-content-3" class="faq-content hidden p-3 pt-0">
                            <p>L'efficacité varie selon le type de terrain : sur une prairie, une brebis entretient environ 500 m² par semaine. Sur un jardin ou un terrain entretenu régulièrement, cette surface est réduite à environ 420 m² par semaine. Sur une friche ou en forêt, l'efficacité est moindre, avec environ 330 m² par semaine. Nous adaptons le nombre de brebis en fonction de ces paramètres pour garantir un entretien optimal.</p>
                        </div>
                    </div>
                    
                    <div class="border border-gray-200 dark:border-gray-600 rounded-lg overflow-hidden">
                        <button class="faq-toggle w-full flex justify-between items-center p-3 text-left font-medium" aria-expanded="false" aria-controls="faq-content-4">
                            <span>Faut-il des autorisations particulières ?</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform transition-transform" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="faq-content-4" class="faq-content hidden p-3 pt-0">
                            <p>Pour un service de courte durée comme une semaine, aucune autorisation particulière n'est généralement nécessaire pour les terrains privés. Pour les terrains situés en zone urbaine ou dans certaines communes, nous vous conseillons de vérifier auprès de votre mairie. Nous nous occupons de toutes les formalités sanitaires et administratives liées aux animaux.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-6 px-4 bg-gray-800 text-white">
        <div class="container mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h2 class="text-xl font-bold">ARTZAINAK</h2>
                    <p class="text-sm">Éducation de chiens de troupeau au Pays Basque</p>
                </div>
                
                <div class="text-sm text-center md:text-right">
                    <div class="flex gap-4 justify-center md:justify-end mb-2">
                        <a href="reservation.html" class="text-white hover:text-primary transition duration-300">Réserver un cours</a>
                        <a href="location.html" class="text-white hover:text-basque-green transition duration-300">Louer des brebis</a>
                        <a href="ressources.html" class="text-white hover:text-primary transition duration-300">Ressources</a>
                        <a href="contact.html" class="text-white hover:text-gray-300 transition duration-300">Contact</a>
                    </div>
                    <p>&copy; 2023 Artzainak. Tous droits réservés.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal pour l'explication du calculateur -->
    <div id="calculatorExplanationModal" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md mx-4">
            <h4 class="text-lg font-bold mb-3">Comment fonctionne notre calculateur ?</h4>
            <div class="space-y-3 text-sm">
                <p>Notre calculateur se base sur ces principes :</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong>Surface minimale :</strong> 2000m² pour assurer un service efficace.</li>
                    <li><strong>Type de terrain :</strong> Influence la capacité de pâturage des brebis.</li>
                    <li><strong>Brebis de race Manex :</strong> Adaptées à différents types de terrains.</li>
                    <li><strong>Capacité de pâturage :</strong>
                        <ul class="pl-4 mt-1 space-y-1">
                            <li>Prairie : 500 m²/semaine par brebis</li>
                            <li>Jardin : 420 m²/semaine par brebis</li>
                            <li>Friche : 330 m²/semaine par brebis</li>
                        </ul>
                    </li>
                    <li><strong>Prix hebdomadaire :</strong> Basé sur le nombre de brebis et la distance.</li>
                </ul>
                <p class="text-xs italic mt-2">Données basées sur notre expérience et des références du secteur de l'écopâturage.</p>
            </div>
            <button id="closeHelpModal" class="mt-4 bg-basque-green text-white py-2 px-4 rounded-lg w-full hover:bg-basque-green/80 transition-colors">
                Compris
            </button>
        </div>
    </div>
    
    <!-- Script Cal.com -->
    <script src="https://app.cal.com/embed/embed.js"></script>
    
    <!-- Scripts personnalisés -->
    <script src="js/script.js"></script>
    <script src="js/mobile-optimizations.js"></script>
    <script src="js/performance-optimizations.js"></script>
    <script src="js/floating-cta.js"></script>
    
    <script>
    // Calculateur d'écopâturage amélioré basé sur le document de référence
    document.addEventListener('DOMContentLoaded', function() {
        // Configuration du calculateur
        const config = {
            // Surface minimale requise en m²
            minSurface: 2000,
            
            // Coefficients par type de terrain
            coefficients: {
                "prairie": 1.0,  // Herbe riche - valeur fourragère élevée
                "jardin": 1.2,   // Herbe entretenue - valeur fourragère moyenne
                "friche": 1.5    // Végétation dense - valeur fourragère basse
            },
            
            // Capacité de pâturage par brebis Manex (m²/semaine)
            sheepCapacityPerWeek: {
                "prairie": 500,  // Une brebis peut entretenir 500m² par semaine en prairie
                "jardin": 420,   // Environ 420m² par semaine en jardin entretenu
                "friche": 330    // Environ 330m² par semaine en terrain difficile
            },
            
            // Tarifs
            tarifs: {
                // Prix de base par brebis par semaine
                sheepPricePerWeek: 15,
                
                // Distance à partir de laquelle des frais supplémentaires s'appliquent (en km)
                distanceThreshold: 20,
                
                // Frais par km au-delà du seuil (€/km)
                distanceFee: 2
            }
        };

        // Fonction pour calculer la distance (simulée pour l'exemple)
        function calculateDistance(address) {
            return new Promise((resolve) => {
                // Simulation d'un appel d'API de géocodage
                setTimeout(() => {
                    // Pour cet exemple, générer une distance aléatoire entre 5 et 35 km
                    const distance = Math.floor(Math.random() * 30) + 5;
                    resolve(distance);
                }, 1500);
            });
        }

        // Fonction pour calculer l'écopâturage
        async function calculateEcoPasture() {
            // Récupération des valeurs du formulaire
            const landSize = parseFloat(document.getElementById('landSize').value);
            const terrain = document.getElementById('terrain').value;
            const address = document.getElementById('address').value;
            
            // Validation de la taille du terrain
            if (landSize < config.minSurface) {
                document.getElementById('sizeError').classList.remove('hidden');
                return;
            } else {
                document.getElementById('sizeError').classList.add('hidden');
            }
            
            // Affichage des résultats initiaux
            document.getElementById('calculationResult').classList.remove('hidden');
            document.getElementById('calculationResult').classList.add('calculation-fade-in');
            document.getElementById('loadingDistance').classList.remove('hidden');
            document.getElementById('areaSummary').textContent = landSize.toLocaleString('fr-FR');
            
            // Afficher le type de terrain
            let terrainTypeName;
            switch(terrain) {
                case 'prairie':
                    terrainTypeName = "Prairie (valeur fourragère élevée)";
                    break;
                case 'friche':
                    terrainTypeName = "Friche/Forêt (valeur fourragère basse)";
                    break;
                default: // jardin (pelouse/jardin)
                    terrainTypeName = "Pelouse/Jardin (valeur fourragère moyenne)";
            }
            document.getElementById('terrainTypeSummary').textContent = terrainTypeName;
            
            // Calcul du nombre de brebis nécessaires pour une semaine
            // basé sur la surface et le coefficient du terrain
            const sheepCapacity = config.sheepCapacityPerWeek[terrain];
            // On divise la surface par la capacité pour obtenir le nombre de brebis nécessaires
            const sheepCount = Math.max(5, Math.ceil(landSize / sheepCapacity));
            document.getElementById('sheepCount').textContent = sheepCount;
            
            try {
                let distance;
                
                if (address) {
                    // Calcul de la distance (appel d'API simulé)
                    distance = await calculateDistance(address);
                    document.getElementById('distanceSummary').textContent = distance;
                    document.getElementById('distanceWarning').classList.add('hidden');
                } else {
                    // Gestion sans adresse
                    distance = "Non déterminée";
                    document.getElementById('distanceSummary').textContent = distance;
                    document.getElementById('distanceWarning').classList.remove('hidden');
                }
                
                // Calcul du prix basé sur le nombre de brebis et la distance
                let weeklyPrice;
                
                if (distance === "Non déterminée") {
                    // Prix approximatif sans distance
                    weeklyPrice = sheepCount * config.tarifs.sheepPricePerWeek;
                    document.getElementById('totalPrice').textContent = `~${weeklyPrice.toLocaleString('fr-FR')} (estimation)`;
                } else {
                    // Calcul du prix avec la distance
                    const basePricePerSheep = config.tarifs.sheepPricePerWeek;
                    const distanceFee = Math.max(0, (distance - config.tarifs.distanceThreshold) * config.tarifs.distanceFee);
                    
                    // Prix hebdomadaire
                    weeklyPrice = (sheepCount * basePricePerSheep) + distanceFee;
                    document.getElementById('totalPrice').textContent = `${weeklyPrice.toLocaleString('fr-FR')}`;
                }
                
                // Calculer impact écologique
                document.getElementById('eco-impact').classList.remove('hidden');
                
                // Calculer les économies CO2 approximatives par rapport à une tondeuse
                const hectares = landSize / 10000;
                const co2SavingsPerHectare = 25; // kg de CO2 économisés par hectare
                const co2Savings = Math.round(hectares * co2SavingsPerHectare);
                document.getElementById('co2Savings').textContent = co2Savings;
                
                // Calculer économie d'eau
                const waterSavingsPerHectare = 2000; // litres d'eau économisés par hectare
                const waterSavings = Math.round(hectares * waterSavingsPerHectare);
                document.getElementById('waterSavings').textContent = waterSavings;
                
                // Afficher bouton de réservation avec animation
                const bookingContainer = document.getElementById('booking-btn-container');
                bookingContainer.classList.remove('hidden');
                bookingContainer.classList.add('calculation-fade-in');
                
                // Masquer le loader
                document.getElementById('loadingDistance').classList.add('hidden');
            } catch (error) {
                console.error("Erreur lors du calcul:", error);
                document.getElementById('distanceSummary').textContent = "Erreur";
                document.getElementById('distanceWarning').classList.remove('hidden');
                document.getElementById('loadingDistance').classList.add('hidden');
                
                // Message d'erreur plus convivial
                const errorMessage = document.createElement('div');
                errorMessage.className = 'p-3 bg-basque-red/10 text-basque-red rounded-lg mt-3';
                errorMessage.innerHTML = `
                    <p>Une erreur s'est produite lors du calcul. Veuillez réessayer ou nous contacter directement.</p>
                `;
                
                // Ajouter au résultat
                document.getElementById('calculationResult').appendChild(errorMessage);
            }
        }

        // Attacher l'événement au bouton
        const calculateBtn = document.getElementById('calculateBtn');
        if (calculateBtn) {
            calculateBtn.addEventListener('click', calculateEcoPasture);
        }
        
        // Ajouter des événements aux champs du formulaire pour validation instantanée
        const landSizeInput = document.getElementById('landSize');
        if (landSizeInput) {
            landSizeInput.addEventListener('input', function() {
                if (parseFloat(this.value) < config.minSurface) {
                    document.getElementById('sizeError').classList.remove('hidden');
                } else {
                    document.getElementById('sizeError').classList.add('hidden');
                }
            });
            
            // Validation sur la touche entrée
            landSizeInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && parseFloat(this.value) >= config.minSurface) {
                    calculateBtn.click();
                }
            });
            
            // Vérifier la valeur initiale
            if (parseFloat(landSizeInput.value) < config.minSurface) {
                document.getElementById('sizeError').classList.remove('hidden');
            }
        }
        
        // Permettre l'appui sur Entrée dans le champ adresse
        const addressInput = document.getElementById('address');
        if (addressInput) {
            addressInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    calculateBtn.click();
                }
            });
        }
        
        // Gestion du bouton d'aide pour le calculateur
        const helpCalculator = document.getElementById('helpCalculator');
        const calculatorModal = document.getElementById('calculatorExplanationModal');
        const closeHelpModal = document.getElementById('closeHelpModal');
        
        if (helpCalculator && calculatorModal && closeHelpModal) {
            helpCalculator.addEventListener('click', function() {
                calculatorModal.classList.remove('hidden');
            });
            
            closeHelpModal.addEventListener('click', function() {
                calculatorModal.classList.add('hidden');
            });
            
            // Fermer en cliquant en dehors
            calculatorModal.addEventListener('click', function(e) {
                if (e.target === calculatorModal) {
                    calculatorModal.classList.add('hidden');
                }
            });
            
            // Fermer avec Echap
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !calculatorModal.classList.contains('hidden')) {
                    calculatorModal.classList.add('hidden');
                }
            });
        }
        
        // Gestion des FAQ
        const faqToggles = document.querySelectorAll('.faq-toggle');
        faqToggles.forEach(toggle => {
            toggle.addEventListener('click', function() {
                const content = this.nextElementSibling;
                const icon = this.querySelector('svg');
                
                // Fermer toutes les autres FAQ
                faqToggles.forEach(otherToggle => {
                    if (otherToggle !== this) {
                        const otherContent = otherToggle.nextElementSibling;
                        const otherIcon = otherToggle.querySelector('svg');
                        
                        otherContent.classList.add('hidden');
                        otherToggle.setAttribute('aria-expanded', 'false');
                        otherIcon.classList.remove('rotate-180');
                    }
                });
                
                // Ouvrir/fermer celle-ci
                const expanded = content.classList.toggle('hidden') ? 'false' : 'true';
                this.setAttribute('aria-expanded', expanded);
                
                // Rotation de l'icône
                icon.classList.toggle('rotate-180', expanded === 'true');
                
                // Attributs ARIA
                this.setAttribute('aria-controls', content.id);
            });
        });
        
        // Masquer le loader du calendrier
        window.hideLoading = function(loaderId) {
            const loader = document.getElementById(loaderId);
            if (loader) {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 300);
            }
        };
        
        // Initialiser Cal.com avec le bon thème
        if (typeof Cal !== 'undefined') {
            Cal('ui', {
                theme: 'dark',
                styles: {
                    branding: {
                        brandColor: '#198754'
                    }
                },
                hideEventTypeDetails: false,
                layout: 'month_view'
            });
        } else {
            console.warn("Cal.com n'est pas chargé correctement");
            
            // Charger Cal.com dynamiquement si nécessaire
            const script = document.createElement('script');
            script.src = "https://app.cal.com/embed/embed.js";
            script.onload = function() {
                console.log("Cal.com chargé dynamiquement");
                if (typeof Cal !== 'undefined') {
                    Cal('ui', {
                        theme: 'dark',
                        styles: {
                            branding: {
                                brandColor: '#198754'
                            }
                        },
                        hideEventTypeDetails: false,
                        layout: 'month_view'
                    });
                }
            };
            document.head.appendChild(script);
        }
        
        // Gestion du menu mobile
        const menuToggle = document.getElementById('menuToggle');
        const mobileNav = document.getElementById('mobileNav');
        
        if (menuToggle && mobileNav) {
            menuToggle.addEventListener('click', function() {
                // Toggle du menu
                mobileNav.classList.toggle('hidden');
                
                // Mettre à jour l'état aria-expanded
                const isExpanded = !mobileNav.classList.contains('hidden');
                menuToggle.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');
            });
        }
        
        // Amélioration de l'accessibilité
        document.querySelectorAll('a, button').forEach(element => {
            if (!element.getAttribute('aria-label') && !element.textContent.trim()) {
                const purpose = element.querySelector('svg') ? 'Bouton' : 'Lien';
                element.setAttribute('aria-label', `${purpose} ${element.getAttribute('href') || ''}`);
            }
        });
        
        // Vérification initiale pour scroll automatique si un hash est présent dans l'URL
        if (window.location.hash) {
            const targetElement = document.querySelector(window.location.hash);
            if (targetElement) {
                setTimeout(() => {
                    window.scrollTo({
                        top: targetElement.offsetTop - 100,
                        behavior: 'smooth'
                    });
                }, 500);
            }
        }
        
        // Gestion des événements de réservation Cal.com
        window.addEventListener('message', function(e) {
            // Vérifier que le message provient de Cal.com
            if (e.data && typeof e.data === 'object') {
                // Traiter les différents types de messages de Cal.com
                if (e.data.type === 'BOOKING_CREATED' || 
                    e.data.type === 'CAL:BOOKING_SUCCESSFUL' || 
                    e.data.type === 'BOOKING_COMPLETED') {
                    
                    try {
                        console.log('Réservation Cal.com détectée:', e.data);
                        
                        // Extraction des données de réservation
                        let bookingData = e.data.data || e.data.detail || {};
                        
                        // Afficher un message de confirmation
                        showBookingConfirmation(bookingData);
                    } catch (error) {
                        console.error('Erreur lors du traitement de la réservation:', error);
                    }
                }
            }
        });
        
        // Fonction pour afficher la confirmation de réservation
        function showBookingConfirmation(bookingData) {
            // Créer l'élément de confirmation
            const confirmationOverlay = document.createElement('div');
            confirmationOverlay.className = 'fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-70';
            
            // Extraire les données
            const bookingDate = bookingData.date || 
                              (bookingData.startTime && bookingData.startTime.split('T')[0]) || 
                              new Date().toISOString().split('T')[0];
            
            const bookingTime = bookingData.startTime || '';
            
            // Formater la date
            const formattedDate = new Date(bookingDate).toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Formater l'heure si disponible
            const formattedTime = bookingTime.split('T')[1] ? 
                bookingTime.split('T')[1].substring(0, 5).replace(':', 'h') : '';
            
            // Contenu HTML
            confirmationOverlay.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md mx-4 shadow-xl">
                    <div class="flex items-center justify-center text-basque-green mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold mb-2 text-center">Réservation confirmée !</h3>
                    <div class="mb-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                        <p><strong>Type de service :</strong> Location de brebis (1 semaine)</p>
                        <p><strong>Date :</strong> ${formattedDate}</p>
                        ${formattedTime ? `<p><strong>Heure :</strong> ${formattedTime}</p>` : ''}
                    </div>
                    <p class="text-center mb-4">Nous vous contacterons dans les plus brefs délais pour confirmer les détails de votre réservation et organiser la livraison des brebis.</p>
                    <button class="close-confirmation block w-full text-center bg-basque-green hover:bg-basque-green/80 text-white font-medium py-2 px-4 rounded transition duration-300">
                        Fermer
                    </button>
                </div>
            `;
            
            // Ajouter à la page
            document.body.appendChild(confirmationOverlay);
            
            // Gérer la fermeture
            confirmationOverlay.querySelector('.close-confirmation').addEventListener('click', function() {
                document.body.removeChild(confirmationOverlay);
            });
            
            // Fermer en cliquant en dehors ou avec Échap
            confirmationOverlay.addEventListener('click', function(e) {
                if (e.target === confirmationOverlay) {
                    document.body.removeChild(confirmationOverlay);
                }
            });
            
            document.addEventListener('keydown', function handleEsc(e) {
                if (e.key === 'Escape' && document.contains(confirmationOverlay)) {
                    document.body.removeChild(confirmationOverlay);
                    document.removeEventListener('keydown', handleEsc);
                }
            });
        }
    });
    </script>
</body>
</html>
