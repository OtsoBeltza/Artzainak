<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Louer des brebis - Artzainak</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            dark: '#4A49B0'
                        },
                        basque: {
                            red: '#DC3545',
                            green: '#198754'
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Header -->
    <header class="bg-primary p-4 text-white sticky top-0 z-10 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <a href="index.html" class="text-xl font-bold">ARTZAINAK</a>
            <p class="text-sm hidden sm:block">Éducation de chiens de troupeau au Pays Basque</p>
            <button id="menuToggle" class="md:hidden focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <nav id="mainNav" class="hidden md:block">
                <ul class="flex space-x-4">
                    <li><a href="index.html" class="hover:underline">Accueil</a></li>
                    <li><a href="index.html#services" class="hover:underline">Services</a></li>
                    <li><a href="reservation.html" class="hover:underline">Réserver</a></li>
                    <li><a href="location.html" class="hover:underline font-bold">Louer</a></li>
                    <li><a href="contact.html" class="hover:underline">Contact</a></li>
                </ul>
            </nav>
        </div>
        <nav id="mobileNav" class="hidden bg-primary-dark py-2 px-4">
            <ul class="space-y-2">
                <li><a href="index.html" class="block hover:underline">Accueil</a></li>
                <li><a href="index.html#services" class="block hover:underline">Services</a></li>
                <li><a href="reservation.html" class="block hover:underline">Réserver</a></li>
                <li><a href="location.html" class="block hover:underline font-bold">Louer</a></li>
                <li><a href="contact.html" class="block hover:underline">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Page Title -->
    <div class="bg-basque-green/10 dark:bg-basque-green/20 py-6">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center">Location de brebis pour écopâturage</h1>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <!-- Introduction -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4">Entretenez vos espaces verts naturellement</h2>
                <p class="mb-4">L'écopâturage est une solution écologique et économique pour l'entretien de vos terrains. Nos brebis débroussaillent efficacement tout en fertilisant naturellement votre sol.</p>
                
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <h3 class="font-semibold mb-2">Avantages de l'écopâturage :</h3>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>Solution 100% écologique sans produits chimiques</li>
                        <li>Entretien régulier et fertilisation naturelle du sol</li>
                        <li>Préservation de la biodiversité locale</li>
                        <li>Débroussaillage efficace même sur terrains difficiles</li>
                        <li>Alternative économique aux méthodes mécaniques</li>
                    </ul>
                </div>
            </div>
            
            <!-- Photo Gallery -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold mb-4">L'écopâturage en images</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- Exemple d'images - Remplacez par vos propres images -->
                    <div class="aspect-video rounded overflow-hidden">
                        <img src="images/sheep1.jpg" alt="Brebis en écopâturage" class="w-full h-full object-cover">
                    </div>
                    <div class="aspect-video rounded overflow-hidden">
                        <img src="images/sheep2.jpg" alt="Tonte naturelle" class="w-full h-full object-cover">
                    </div>
                    <div class="aspect-video rounded overflow-hidden">
                        <img src="images/sheep3.jpg" alt="Entretien écologique" class="w-full h-full object-cover">
                    </div>
                </div>
            </div>
            
            <!-- Calculator -->
            <div class="mb-8 p-4 bg-basque-green/5 dark:bg-basque-green/10 rounded-lg">
                <h3 class="font-semibold mb-3">Calculateur d'écopâturage :</h3>
                <p class="mb-4 text-sm">Estimez le nombre de brebis nécessaires et le coût pour votre terrain (forfait à la semaine) :</p>
                
                <div class="space-y-4">
                    <div>
                        <label for="landSize" class="block mb-1 font-medium text-sm">Surface de votre terrain (m²)</label>
                        <input type="number" id="landSize" min="1000" value="1000" 
                            class="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <p id="sizeError" class="text-basque-red text-xs mt-1 hidden">La surface minimum est de 1000m²</p>
                    </div>
                    
                    <div>
                        <label for="address" class="block mb-1 font-medium text-sm">Adresse du terrain</label>
                        <input type="text" id="address" placeholder="Ex: 10 rue des Fleurs, 64200 Biarritz"
                            class="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <p id="distanceMessage" class="text-xs mt-1 italic">Nous calculerons automatiquement la distance depuis Arbonne.</p>
                    </div>
                    
                    <div>
                        <label for="terrain" class="block mb-1 font-medium text-sm">Type de terrain</label>
                        <select id="terrain" class="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="normal">Prairie normale</option>
                            <option value="rich">Prairie riche</option>
                            <option value="poor">Prairie pauvre</option>
                        </select>
                    </div>
                    
                    <button id="calculateBtn" class="bg-basque-green hover:bg-basque-green/80 text-white font-medium py-2 px-4 rounded transition duration-300 text-sm">
                        Calculer
                    </button>
                </div>
                
                <div id="calculationResult" class="hidden mt-4 p-4 bg-gray-100 dark:bg-gray-600 rounded-lg text-sm">
                    <div id="loadingDistance" class="mb-2 text-xs flex items-center">
                        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-basque-green" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Calcul de la distance en cours...
                    </div>
                    <p class="mb-1">Surface à entretenir: <span id="areaSummary" class="font-medium">0</span> m²</p>
                    <p class="mb-1">Type de terrain: <span id="terrainTypeSummary" class="font-medium">Prairie normale</span></p>
                    <p class="mb-1">Nombre de brebis recommandé: <span id="sheepCount" class="font-medium">0</span></p>
                    <p class="mb-1">Distance depuis Arbonne: <span id="distanceSummary" class="font-medium">0</span> km</p>
                    <p class="font-bold mt-2 text-base">Estimation du tarif: <span id="totalPrice">0</span> € / semaine</p>
                    <p class="mt-1 text-xs italic">Forfait hebdomadaire incluant livraison, installation et suivi des animaux</p>
                </div>
            </div>
            
            <!-- Rental Form -->
            <form id="rentalForm" class="space-y-6">
                <h3 class="text-lg font-semibold">Formulaire de demande d'écopâturage</h3>
                
                <!-- Personal Information -->
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="firstName" class="block mb-1 font-medium">Prénom</label>
                            <input type="text" id="firstName" name="firstName" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label for="lastName" class="block mb-1 font-medium">Nom</label>
                            <input type="text" id="lastName" name="lastName" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="email" class="block mb-1 font-medium">Email</label>
                            <input type="email" id="email" name="email" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label for="phone" class="block mb-1 font-medium">Téléphone</label>
                            <input type="tel" id="phone" name="phone" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>
                </div>
                
                <!-- Land Information -->
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium mb-4">Informations sur votre terrain</h4>
                    
                    <div class="mb-4">
                        <label for="landAddress" class="block mb-1 font-medium">Adresse du terrain</label>
                        <textarea id="landAddress" name="landAddress" rows="2" required
                            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="landSizeForm" class="block mb-1 font-medium">Surface approximative (m²)</label>
                            <input type="number" id="landSizeForm" name="landSizeForm" min="1000" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label for="landType" class="block mb-1 font-medium">Type de terrain</label>
                            <select id="landType" name="landType" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">Sélectionnez un type</option>
                                <option value="flat">Terrain plat</option>
                                <option value="slope">Terrain en pente</option>
                                <option value="varied">Terrain varié</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="landDescription" class="block mb-1 font-medium">Description du terrain</label>
                        <textarea id="landDescription" name="landDescription" rows="3" placeholder="Végétation, accès, particularités..."
                            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
                    </div>
                </div>
                
                <!-- Service Details -->
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium mb-4">Détails du service</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="startDate" class="block mb-1 font-medium">Date de début souhaitée</label>
                            <input type="date" id="startDate" name="startDate" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label for="duration" class="block mb-1 font-medium">Durée souhaitée</label>
                            <select id="duration" name="duration" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">Sélectionnez une durée</option>
                                <option value="1week">1 semaine</option>
                                <option value="2weeks">2 semaines</option>
                                <option value="1month">1 mois</option>
                                <option value="season">Saison complète</option>
                                <option value="custom">Autre (préciser)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="customDurationContainer" class="hidden mb-4">
                        <label for="customDuration" class="block mb-1 font-medium">Précisez la durée souhaitée</label>
                        <input type="text" id="customDuration" name="customDuration" placeholder="Ex: 3 semaines, 2 mois..."
                            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                </div>
                
                <!-- Land Photos -->
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium mb-4">Photos du terrain (optionnel)</h4>
                    
                    <div class="mb-4">
                        <label for="landPhotos" class="block mb-1 font-medium">Téléchargez des photos</label>
                        <input type="file" id="landPhotos" name="landPhotos" accept="image/*" multiple
                            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <p class="text-xs mt-1 text-gray-500 dark:text-gray-400">Format JPG ou PNG, max 5 MB par photo, jusqu'à 3 photos</p>
                    </div>
                    
                    <div id="photosPreviewContainer" class="hidden mb-4">
                        <p class="mb-2 font-medium">Aperçu :</p>
                        <div class="flex flex-wrap gap-4" id="photosPreview">
                            <!-- Photos preview will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <!-- Additional Information -->
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium mb-4">Informations complémentaires</h4>
                    
                    <div class="mb-4">
                        <label for="additionalInfo" class="block mb-1 font-medium">Questions ou précisions</label>
                        <textarea id="additionalInfo" name="additionalInfo" rows="3" placeholder="Toute information utile pour votre demande..."
                            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-basque-green dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button type="submit" id="submitButton" class="w-full bg-basque-green hover:bg-basque-green/80 text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                        Envoyer ma demande d'écopâturage
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-6 px-4 bg-gray-800 text-white">
        <div class="container mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h2 class="text-xl font-bold">ARTZAINAK</h2>
                    <p class="text-sm">Éducation de chiens de troupeau au Pays Basque</p>
                </div>
                
                <div class="text-sm text-center md:text-right">
                    <div class="flex gap-4 justify-center md:justify-end mb-2">
                        <a href="reservation.html" class="text-white hover:text-primary transition duration-300">Réserver un cours</a>
                        <a href="location.html" class="text-white hover:text-basque-green transition duration-300">Louer des brebis</a>
                        <a href="contact.html" class="text-white hover:text-gray-300 transition duration-300">Contact</a>
                    </div>
                    <p>&copy; 2023 Artzainak. Tous droits réservés.</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Notification de succès -->
    <div id="successNotification" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md mx-4 shadow-xl">
            <div class="flex items-center justify-center text-basque-green mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h3 class="text-xl font-bold mb-2 text-center">Demande envoyée avec succès !</h3>
            <p class="text-center mb-4">Nous vous contacterons rapidement pour discuter des détails et établir un devis personnalisé.</p>
            <button id="closeNotification" class="w-full bg-basque-green hover:bg-basque-green/80 text-white font-medium py-2 px-4 rounded transition duration-300">
                Fermer
            </button>
        </div>
    </div>
    
    <script src="js/script.js"></script>
    <script>
        // URL de votre script Google Apps Script déployé en tant qu'application web
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxrO7ot7RiHaQql6uUMpMmLsIw1AQLQG7l6mXie1p2pZAepRpnPEobFQrYcdHXZXBJfeQ/exec";
        
        // Constantes pour le calcul de distance
        const ARBONNE_LAT = 43.4373; // Latitude d'Arbonne
        const ARBONNE_LNG = -1.5477; // Longitude d'Arbonne
            
        // Fonction pour calculer la distance entre deux points (formule de Haversine)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Rayon de la Terre en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c; // Distance en km
            return Math.round(distance);
        }
        
        // Fonction pour géocoder une adresse (obtenir lat/lng)
        async function geocodeAddress(address) {
            try {
                // On ajoute "France" à l'adresse pour améliorer la précision
                if (!address.toLowerCase().includes('france')) {
                    address += ', France';
                }
                
                // Encoder l'adresse pour l'URL
                const encodedAddress = encodeURIComponent(address);
                
                // Utiliser l'API Nominatim d'OpenStreetMap (gratuite et sans clé API)
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodedAddress}&limit=1`);
                const data = await response.json();
                
                if (data && data.length > 0) {
                    return {
                        lat: parseFloat(data[0].lat),
                        lng: parseFloat(data[0].lon)
                    };
                } else {
                    throw new Error("Adresse introuvable");
                }
            } catch (error) {
                console.error("Erreur de géocodage:", error);
                return null;
            }
        }
        
        // Calculateur d'écopâturage
        document.getElementById('calculateBtn').addEventListener('click', async function() {
            const landSize = parseFloat(document.getElementById('landSize').value);
            const terrain = document.getElementById('terrain').value;
            const address = document.getElementById('address').value;
            
            // Validation de la taille du terrain
            if (landSize < 1000) {
                document.getElementById('sizeError').classList.remove('hidden');
                return;
            } else {
                document.getElementById('sizeError').classList.add('hidden');
            }
            
            // Affichage des résultats initiaux
            document.getElementById('calculationResult').classList.remove('hidden');
            document.getElementById('loadingDistance').classList.remove('hidden');
            document.getElementById('areaSummary').textContent = landSize.toLocaleString();
            
            // Calcul du nombre de brebis nécessaires selon le type de terrain
            let sheepPerHectare;
            let terrainTypeName;
            
            switch(terrain) {
                case 'rich':
                    sheepPerHectare = 15;
                    terrainTypeName = "Prairie riche";
                    break;
                case 'poor':
                    sheepPerHectare = 5;
                    terrainTypeName = "Prairie pauvre";
                    break;
                default: // normal
                    sheepPerHectare = 10;
                    terrainTypeName = "Prairie normale";
            }
            
            document.getElementById('terrainTypeSummary').textContent = terrainTypeName;
            
            // Calcul du nombre de brebis (conversion m² en hectares)
            const hectares = landSize / 10000;
            const sheepCount = Math.max(5, Math.round(hectares * sheepPerHectare));
            document.getElementById('sheepCount').textContent = sheepCount;
            
            // Calcul de la distance et du prix
            if (address) {
                try {
                    const geoData = await geocodeAddress(address);
                    if (geoData) {
                        const distance = calculateDistance(ARBONNE_LAT, ARBONNE_LNG, geoData.lat, geoData.lng);
                        document.getElementById('distanceSummary').textContent = distance;
                        
                        // Calcul du prix basé sur le nombre de brebis et la distance
                        const basePricePerSheep = 15; // Prix de base par brebis par semaine
                        const distanceFee = Math.max(0, (distance - 20) * 2); // Frais de distance au-delà de 20km
                        
                        const totalPrice = (sheepCount * basePricePerSheep) + distanceFee;
                        document.getElementById('totalPrice').textContent = totalPrice.toLocaleString();
                    } else {
                        document.getElementById('distanceSummary').textContent = "Non déterminée";
                        
                    // Prix approximatif sans distance
                    const approximate// Prix approximatif sans distance
                    const approximatePrice = sheepCount * 15;
                    document.getElementById('totalPrice').textContent = `~${approximatePrice.toLocaleString()} (estimation)`;
                }
            } else {
                document.getElementById('distanceSummary').textContent = "Non déterminée";
                // Prix approximatif sans distance
                const approximatePrice = sheepCount * 15;
                document.getElementById('totalPrice').textContent = `~${approximatePrice.toLocaleString()} (estimation)`;
            }
            
            document.getElementById('loadingDistance').classList.add('hidden');
        });
        
        // Gestion du formulaire de location
        document.getElementById('rentalForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Récupération des données du formulaire
            const formData = new FormData(this);
            
            // Récupérer les valeurs sélectionnées/calculées
            formData.append('calculatedSheepCount', document.getElementById('sheepCount').textContent || '0');
            formData.append('calculatedPrice', document.getElementById('totalPrice').textContent || '0');
            
            // Si une durée personnalisée est spécifiée
            if (document.getElementById('duration').value === 'custom') {
                formData.append('durationDetail', document.getElementById('customDuration').value);
            }
            
            try {
                // Afficher un indicateur de chargement sur le bouton
                const submitButton = document.getElementById('submitButton');
                const originalButtonText = submitButton.innerHTML;
                submitButton.innerHTML = '<svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Envoi en cours...';
                submitButton.disabled = true;
                
                // Envoi des données au script Google Apps Script
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                // Vérification de la réponse
                if (response.ok) {
                    // Afficher la notification de succès
                    document.getElementById('successNotification').classList.remove('hidden');
                    
                    // Réinitialiser le formulaire
                    document.getElementById('rentalForm').reset();
                    
                    // Masquer l'aperçu des photos
                    document.getElementById('photosPreviewContainer').classList.add('hidden');
                    document.getElementById('photosPreview').innerHTML = '';
                } else {
                    throw new Error('Échec de l\'envoi du formulaire');
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Une erreur est survenue lors de l\'envoi du formulaire. Veuillez réessayer plus tard.');
            } finally {
                // Restaurer le bouton
                const submitButton = document.getElementById('submitButton');
                submitButton.innerHTML = originalButtonText;
                submitButton.disabled = false;
            }
        });
        
        // Gestion de la durée personnalisée
        document.getElementById('duration').addEventListener('change', function() {
            const customDurationContainer = document.getElementById('customDurationContainer');
            if (this.value === 'custom') {
                customDurationContainer.classList.remove('hidden');
                document.getElementById('customDuration').required = true;
            } else {
                customDurationContainer.classList.add('hidden');
                document.getElementById('customDuration').required = false;
            }
        });
        
        // Prévisualisation des photos
        document.getElementById('landPhotos').addEventListener('change', function(e) {
            const previewContainer = document.getElementById('photosPreviewContainer');
            const previewElement = document.getElementById('photosPreview');
            previewElement.innerHTML = '';
            
            // Limiter à 3 photos
            const files = Array.from(e.target.files).slice(0, 3);
            
            if (files.length > 0) {
                previewContainer.classList.remove('hidden');
                
                files.forEach(file => {
                    if (file.type.match('image.*')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const imgContainer = document.createElement('div');
                            imgContainer.className = 'relative';
                            
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'h-24 w-24 object-cover rounded border';
                            
                            imgContainer.appendChild(img);
                            previewElement.appendChild(imgContainer);
                        }
                        reader.readAsDataURL(file);
                    }
                });
            } else {
                previewContainer.classList.add('hidden');
            }
        });
        
        // Notification de succès
        document.getElementById('closeNotification').addEventListener('click', function() {
            document.getElementById('successNotification').classList.add('hidden');
        });
        
        // Copier l'adresse du calculateur vers le formulaire
        document.getElementById('calculateBtn').addEventListener('click', function() {
            const calculatorAddress = document.getElementById('address').value;
            if (calculatorAddress) {
                document.getElementById('landAddress').value = calculatorAddress;
            }
            
            const calculatorSize = document.getElementById('landSize').value;
            if (calculatorSize) {
                document.getElementById('landSizeForm').value = calculatorSize;
            }
        });
        
        // Initialiser la date minimum à aujourd'hui
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        const todayFormatted = `${yyyy}-${mm}-${dd}`;
        document.getElementById('startDate').min = todayFormatted;
    </script>
</body>
</html>
