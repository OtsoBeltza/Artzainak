<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Réserver un cours - Artzainak</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            dark: '#4A49B0'
                        },
                        basque: {
                            red: '#DC3545',
                            green: '#198754'
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Notification de succès -->
    <div id="successNotification" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md mx-4 shadow-xl">
            <div class="flex items-center justify-center text-basque-green mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h3 class="text-xl font-bold mb-2 text-center">Demande envoyée avec succès !</h3>
            <p class="text-center mb-4">Nous vous contacterons rapidement pour discuter des détails et établir un devis personnalisé.</p>
            <button id="closeNotification" class="w-full bg-basque-green hover:bg-basque-green/80 text-white font-medium py-2 px-4 rounded transition duration-300">
                Fermer
            </button>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-primary p-4 text-white sticky top-0 z-10 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <a href="index.html" class="text-xl font-bold">ARTZAINAK</a>
            <p class="text-sm hidden sm:block">Éducation de chiens de troupeau au Pays Basque</p>
            <button id="menuToggle" class="md:hidden focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <nav id="mainNav" class="hidden md:block">
                <ul class="flex space-x-4">
                    <li><a href="index.html" class="hover:underline">Accueil</a></li>
                    <li><a href="index.html#services" class="hover:underline">Services</a></li>
                    <li><a href="reservation.html" class="hover:underline font-bold">Réserver</a></li>
                    <li><a href="location.html" class="hover:underline">Louer</a></li>
                    <li><a href="contact.html" class="hover:underline">Contact</a></li>
                </ul>
            </nav>
        </div>
        <nav id="mobileNav" class="hidden bg-primary-dark py-2 px-4">
            <ul class="space-y-2">
                <li><a href="index.html" class="block hover:underline">Accueil</a></li>
                <li><a href="index.html#services" class="block hover:underline">Services</a></li>
                <li><a href="reservation.html" class="block hover:underline font-bold">Réserver</a></li>
                <li><a href="location.html" class="block hover:underline">Louer</a></li>
                <li><a href="contact.html" class="block hover:underline">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Page Title -->
    <div class="bg-primary/10 dark:bg-primary/20 py-6">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center">Réservation de cours d'éducation canine</h1>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <!-- Introduction -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4">Réservez votre cours d'éducation canine</h2>
                <p class="mb-4">Formez votre chien aux techniques de conduite de troupeau avec notre équipe spécialisée. Que vous soyez débutant ou que vous souhaitiez perfectionner les compétences de votre chien, nous adaptons notre formation à vos besoins.</p>
                
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <h3 class="font-semibold mb-2">Ce que vous devez savoir :</h3>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>Les cours sont disponibles du lundi au vendredi</li>
                        <li>Nos créneaux horaires sont de 8h à 12h et de 14h à 18h (sessions d'une heure)</li>
                        <li>Votre chien doit être à jour dans ses vaccinations</li>
                        <li>Prévoyez une laisse et de l'eau pour votre compagnon</li>
                    </ul>
                </div>
            </div>
            
            <!-- Photo Gallery -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold mb-4">Nos séances d'éducation en images</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <div class="aspect-video rounded overflow-hidden">
                        <img src="images/training1.jpg" alt="Chien en formation" class="w-full h-full object-cover">
                    </div>
                    <div class="aspect-video rounded overflow-hidden">
                        <img src="images/training2.jpg" alt="Session d'entraînement" class="w-full h-full object-cover">
                    </div>
                    <div class="aspect-video rounded overflow-hidden">
                        <img src="images/training3.jpg" alt="Travail avec les brebis" class="w-full h-full object-cover">
                    </div>
                </div>
            </div>
            
            <!-- Formulaire de réservation -->
            <form id="reservationForm" class="space-y-6">
                <h3 class="text-lg font-semibold">Formulaire de réservation</h3>
                
                <!-- Conteneur pour le calendrier -->
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="selectedDate" class="block mb-1 font-medium">Date souhaitée</label>
                            <input 
                                type="date" 
                                id="selectedDate" 
                                required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                            >
                        </div>
                        <div>
                            <label for="selectedTime" class="block mb-1 font-medium">Heure préférée</label>
                            <select 
                                id="selectedTime" 
                                required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                            >
                                <option value="">Sélectionnez une heure</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Informations de disponibilité -->
                    <div id="availabilityInfo" class="mt-2"></div>
                </div>

                <!-- Champs cachés pour le formulaire -->
                <input type="hidden" id="preferredDate" name="preferredDate" required>
                <input type="hidden" id="preferredTime" name="preferredTime" required>
                
                <!-- Personal Information -->
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="firstName" class="block mb-1 font-medium">Prénom</label>
                            <input type="text" id="firstName" name="firstName" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label for="lastName" class="block mb-1 font-medium">Nom</label>
                            <input type="text" id="lastName" name="lastName" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="email" class="block mb-1 font-medium">Email</label>
                            <input type="email" id="email" name="email" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label for="phone" class="block mb-1 font-medium">Téléphone</label>
                            <input type="tel" id="phone" name="phone" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>
                </div>
                
                <!-- Dog Information -->
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium mb-4">Informations sur votre chien</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="dogName" class="block mb-1 font-medium">Nom du chien</label>
                            <input type="text" id="dogName" name="dogName" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label for="dogBreed" class="block mb-1 font-medium">Race du chien</label>
                            <input type="text" id="dogBreed" name="dogBreed" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="dogAge" class="block mb-1 font-medium">Âge du chien</label>
                            <input type="number" id="dogAge" name="dogAge" min="1" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label for="experience" class="block mb-1 font-medium">Niveau d'expérience</label>
                            <select id="experience" name="experience" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">Sélectionnez un niveau</option>
                                <option value="beginner">Débutant - aucune expérience</option>
                                <option value="intermediate">Intermédiaire - quelques bases</option>
                                <option value="advanced">Avancé - perfectionnement</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="dogInfo" class="block mb-1 font-medium">Informations supplémentaires</label>
                        <textarea id="dogInfo" name="dogInfo" rows="3" placeholder="Comportement, problèmes spécifiques, objectifs particuliers..."
                            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
                    </div>
                </div>
                
                <!-- Course Details -->
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium mb-4">Détails du cours</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="courseType" class="block mb-1 font-medium">Type de cours</label>
                            <select id="courseType" name="courseType" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">Sélectionnez un type</option>
                                <option value="hour">Cours d'une heure</option>
                                <option value="halfday">Demi-journée</option>
                                <option value="fullday">Journée complète</option>
                            </select>
                        </div>
                        <div>
                            <label for="location" class="block mb-1 font-medium">Lieu du cours</label>
                            <select id="location" name="location" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">Sélectionnez un lieu</option>
                                <option value="arbonne">À Arbonne (notre terrain)</option>
                                <option value="client">À votre domicile</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="clientLocationContainer" class="hidden mb-4">
                        <label for="clientAddress" class="block mb-1 font-medium">Votre adresse</label>
                        <textarea id="clientAddress" name="clientAddress" rows="2" placeholder="Adresse complète pour le cours à domicile"
                            class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button type="submit" id="submitButton" class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                        Envoyer ma demande de réservation
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-6 px-4 bg-gray-800 text-white">
        <div class="container mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h2 class="text-xl font-bold">ARTZAINAK</h2>
                    <p class="text-sm">Éducation de chiens de troupeau au Pays Basque</p>
                </div>
                
                <div class="text-sm text-center md:text-right">
                    <div class="flex gap-4 justify-center md:justify-end mb-2">
                        <a href="reservation.html" class="text-white hover:text-primary transition duration-300">Réserver un cours</a>
                        <a href="location.html" class="text-white hover:text-basque-green transition duration-300">Louer des brebis</a>
                        <a href="contact.html" class="text-white hover:text-gray-300 transition duration-300">Contact</a>
                    </div>
                    <p>&copy; 2023 Artzainak. Tous droits réservés.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
    // Fonction pour générer les créneaux horaires
    function generateTimeSlots() {
        const morningSlots = [];
        const afternoonSlots = [];

        // Créneaux du matin (8h à 12h)
        for (let hour = 8; hour < 12; hour++) {
            morningSlots.push(`${hour}h00 - ${hour}h59`);
        }

        // Créneaux de l'après-midi (14h à 18h)
        for (let hour = 14; hour < 18; hour++) {
            afternoonSlots.push(`${hour}h00 - ${hour}h59`);
        }

        return [...morningSlots, ...afternoonSlots];
    }

    // Fonction pour récupérer les créneaux réservés
    async function fetchReservedSlots(date) {
        try {
            // URL de votre script Google Apps Script déployé
            const scriptURL = 'https://script.google.com/macros/s/AKfycbw1Go-gzAvZrPBw_6l0_njmnjy-kdzursNNFaha1ukmJ2BT4OQQhaMxbk5-Xp8YluypcA/exec';
            
            const response = await fetch(`${scriptURL}?date=${date}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            const data = await response.json();

            if (data.status === 'error') {
                console.error('Erreur de récupération:', data.message);
                return [];
            }

            return data.reservedSlots || [];
        } catch (error) {
            console.error('Erreur lors de la récupération des réservations:', error);
            return [];
        }
    }

    // Fonction pour initialiser le calendrier
    function initializeBookingCalendar() {
        const dateInput = document.getElementById('selectedDate');
        const timeSelect = document.getElementById('selectedTime');
        const availabilityInfo = document.getElementById('availabilityInfo');

        // Définir la date minimale à aujourd'hui
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        dateInput.min = `${yyyy}-${mm}-${dd}`;

        // Événement de changement de date
        dateInput.addEventListener('change', async function() {
            const selectedDate = this.value;
            
            // Mise à jour du champ caché dans le formulaire
            document.getElementById('preferredDate').value = selectedDate;
            
            // Réinitialiser l'heure sélectionnée
            timeSelect.innerHTML = '<option value="">Sélectionnez une heure</option>';
            document.getElementById('preferredTime').value = '';
            
            // Afficher un indicateur de chargement
            availabilityInfo.innerHTML = '<p class="text-gray-600">Vérification des disponibilités...</p>';
            
            // Récupérer les créneaux réservés pour cette date
            const reservedSlots = await fetchReservedSlots(selectedDate);
            
            // Générer tous les créneaux
            const allTimeSlots = generateTimeSlots();
            
            // Filtrer les créneaux disponibles
            const availableSlots = allTimeSlots.filter(slot => !reservedSlots.includes(slot));

            // Mettre à jour le select des heures
            timeSelect.innerHTML = '<option value="">Sélectionnez une heure</option>';
            availableSlots.forEach(slot => {
                const option = document.createElement('option');
                option.value = slot;
                option.textContent = slot;
                timeSelect.appendChild(option);
            });

            // Mettre à jour les informations de disponibilité
            if (availableSlots.length > 0) {
                availabilityInfo.innerHTML = `<p class="text-green-600">${availableSlots.length} créneaux disponibles</p>`;
                if (reservedSlots.length > 0) {
                    availabilityInfo.innerHTML += `
                        <p class="text-gray-600 mt-2">Créneaux déjà réservés :</p>
                        <ul class="list-disc list-inside text-gray-600">
                            ${reservedSlots.map(slot => `<li>${slot}</li>`).join('')}
                        </ul>
                    `;
                }
            } else {
                availabilityInfo.innerHTML = '<p class="text-red-600">Aucun créneau disponible pour cette date</p>';
            }
        });

        // Événement de sélection d'heure
        timeSelect.addEventListener('change', function() {
            document.getElementById('preferredTime').value = this.value;
            
            if (this.value) {
                availabilityInfo.innerHTML += `
                    <div class="bg-green-50 dark:bg-green-900 p-3 mt-3 rounded-lg flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p class="text-green-800 dark:text-green-200">
                            Le créneau est disponible pour votre réservation
                        </p>
                    </div>
                `;
            }
        });
    }

    // Logique pour afficher/masquer le champ d'adresse client
    document.getElementById('location').addEventListener('change', function() {
        const clientLocationContainer = document.getElementById('clientLocationContainer');
        const clientAddressField = document.getElementById('clientAddress');
        
        if (this.value === 'client') {
            clientLocationContainer.classList.remove('hidden');
            clientAddressField.setAttribute('required', true);
        } else {
            clientLocationContainer.classList.add('hidden');
            clientAddressField.removeAttribute('required');
        }
    });
    
    // Gestion du formulaire de réservation
    document.getElementById('reservationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Récupération des données du formulaire
        const formData = new FormData(this);
        
        // URL de votre script Google Apps Script pour l'enregistrement
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwehl0VLqjXD5AYVcrg3HSO4ICFSOVXkzi_k1Y_y5jQ65uyqZcagDk0yC6VaLSJgu7NWg/exec';
        
        try {
            // Afficher un indicateur de chargement sur le bouton
            const submitButton = document.getElementById('submitButton');
            const originalButtonText = submitButton.innerHTML;
            submitButton.innerHTML = '<svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Envoi en cours...';
            submitButton.disabled = true;
            
            // Envoi des données via fetch
            fetch(scriptURL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Afficher la notification de succès
                    document.getElementById('successNotification').classList.remove('hidden');
                    
                    // Réinitialiser le formulaire
                    document.getElementById('reservationForm').reset();
                    
                    // Masquer le champ d'adresse client si visible
                    document.getElementById('clientLocationContainer').classList.add('hidden');
                    
                    // Réinitialiser les sélections de date et heure
                    document.getElementById('availabilityInfo').innerHTML = '';
                    document.getElementById('selectedTime').innerHTML = '<option value="">Sélectionnez une heure</option>';
                    document.getElementById('preferredDate').value = '';
                    document.getElementById('preferredTime').value = '';
                } else {
                    alert('Erreur: ' + (data.message || 'Une erreur est survenue'));
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                alert('Une erreur est survenue lors de l\'envoi du formulaire. Veuillez réessayer plus tard.');
            })
            .finally(() => {
                // Restaurer le bouton
                submitButton.innerHTML = originalButtonText;
                submitButton.disabled = false;
            });
            
        } catch (error) {
            console.error('Erreur:', error);
            alert('Une erreur est survenue lors de l\'envoi du formulaire. Veuillez réessayer plus tard.');
        }
    });

    // Gestion de la notification de succès
    document.getElementById('closeNotification').addEventListener('click', function() {
        document.getElementById('successNotification').classList.add('hidden');
    });
    
    // Initialiser le calendrier une fois le DOM chargé
    document.addEventListener('DOMContentLoaded', initializeBookingCalendar);
    </script>
</body>
</html>
