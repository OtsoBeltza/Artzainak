<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Réserver un cours - Artzainak</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            dark: '#4A49B0'
                        },
                        basque: {
                            red: '#DC3545',
                            green: '#198754'
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Charger React et ReactDOM depuis CDN -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <!-- Charger Babel pour la transpilation JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Bibliothèques supplémentaires pour le calendrier -->
    <link rel="stylesheet" href="https://unpkg.com/react-big-calendar/lib/css/react-big-calendar.css">
    <script src="https://unpkg.com/moment@2.29.1/moment.js"></script>
    <script src="https://unpkg.com/react-big-calendar/lib/index.js"></script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Notification de succès (comme dans votre code original) -->
    <div id="successNotification" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md mx-4 shadow-xl">
            <div class="flex items-center justify-center text-basque-green mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h3 class="text-xl font-bold mb-2 text-center">Demande envoyée avec succès !</h3>
            <p class="text-center mb-4">Nous vous contacterons rapidement pour discuter des détails et établir un devis personnalisé.</p>
            <button id="closeNotification" class="w-full bg-basque-green hover:bg-basque-green/80 text-white font-medium py-2 px-4 rounded transition duration-300">
                Fermer
            </button>
        </div>
    </div>

    <!-- Header (comme dans votre code original) -->
    <header class="bg-primary p-4 text-white sticky top-0 z-10 shadow-md">
        <!-- Votre code de header existant -->
    </header>

    <!-- Page Title -->
    <div class="bg-primary/10 dark:bg-primary/20 py-6">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center">Réservation de cours d'éducation canine</h1>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <!-- Introduction (comme dans votre code original) -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4">Réservez votre cours d'éducation canine</h2>
                <p class="mb-4">Formez votre chien aux techniques de conduite de troupeau avec notre équipe spécialisée. Que vous soyez débutant ou que vous souhaitiez perfectionner les compétences de votre chien, nous adaptons notre formation à vos besoins.</p>
                
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <h3 class="font-semibold mb-2">Ce que vous devez savoir :</h3>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>Les cours sont disponibles du lundi au samedi</li>
                        <li>Nous proposons des sessions d'une heure, d'une demi-journée ou d'une journée complète</li>
                        <li>Votre chien doit être à jour dans ses vaccinations</li>
                        <li>Prévoyez une laisse et de l'eau pour votre compagnon</li>
                    </ul>
                </div>
            </div>
            
            <!-- Photo Gallery (comme dans votre code original) -->
            <div class="mb-8">
                <!-- Votre galerie photo existante -->
            </div>
            
            <!-- Formulaire de réservation -->
            <form id="reservationForm" class="space-y-6">
                <h3 class="text-lg font-semibold">Formulaire de réservation</h3>
                
                <!-- Conteneur pour le calendrier React -->
                <div id="react-calendar-container" class="mb-4"></div>
                
                <!-- Personal Information -->
                <div class="space-y-4">
                    <!-- Vos champs de formulaire existants -->
                    <!-- Les champs de date et d'heure seront désormais gérés par le composant React -->
                    <input type="hidden" id="preferredDate" name="preferredDate" required>
                    <input type="hidden" id="preferredTime" name="preferredTime" required>
                    
                    <!-- Reste de votre formulaire inchangé -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="firstName" class="block mb-1 font-medium">Prénom</label>
                            <input type="text" id="firstName" name="firstName" required
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <!-- Autres champs comme dans votre code original -->
                    </div>
                </div>
                
                <!-- Reste de votre formulaire -->
            </form>
        </div>
    </main>

    <!-- Footer (comme dans votre code original) -->
    <footer class="py-6 px-4 bg-gray-800 text-white">
        <!-- Votre code de footer existant -->
    </footer>
    
    <!-- Script pour le calendrier React -->
    <script type="text/babel">
        const BookingCalendar = () => {
            const [selectedDate, setSelectedDate] = React.useState('');
            const [availableTimes, setAvailableTimes] = React.useState([]);
            const [selectedTime, setSelectedTime] = React.useState('');

            // Simule la récupération des créneaux disponibles
            React.useEffect(() => {
                const fetchAvailableSlots = async () => {
                    // Dans une vraie implémentation, cette fonction 
                    // interrogerait votre backend pour les créneaux disponibles
                    const mockAvailableSlots = {
                        'default': ['Matin (9h-12h)', 'Après-midi (14h-17h)'],
                        '2024-06-15': ['Matin (9h-12h)'],
                        '2024-06-22': ['Après-midi (14h-17h)']
                    };
                    setAvailableTimes(mockAvailableSlots['default']);
                };

                fetchAvailableSlots();
            }, []);

            // Mise à jour des créneaux disponibles quand une date est sélectionnée
            const handleDateChange = (e) => {
                const date = e.target.value;
                setSelectedDate(date);
                
                // Mise à jour du champ caché dans le formulaire
                document.getElementById('preferredDate').value = date;
                
                // Logique de récupération des créneaux spécifiques à la date
                const mockAvailableSlots = {
                    'default': ['Matin (9h-12h)', 'Après-midi (14h-17h)'],
                    '2024-06-15': ['Matin (9h-12h)'],
                    '2024-06-22': ['Après-midi (14h-17h)']
                };
                
                // Utiliser les créneaux spécifiques à la date ou les créneaux par défaut
                setAvailableTimes(mockAvailableSlots[date] || mockAvailableSlots['default']);
                setSelectedTime('');
            };

            // Mise à jour de l'heure sélectionnée
            const handleTimeChange = (e) => {
                const time = e.target.value;
                setSelectedTime(time);
                
                // Mise à jour du champ caché dans le formulaire
                document.getElementById('preferredTime').value = time;
            };

            // Récupération de la date minimale (aujourd'hui)
            const getMinDate = () => {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                return `${yyyy}-${mm}-${dd}`;
            };

            return (
                React.createElement('div', { className: 'space-y-4' },
                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                        React.createElement('div', null,
                            React.createElement('label', { 
                                htmlFor: 'selectedDate', 
                                className: 'block mb-1 font-medium' 
                            }, 'Date souhaitée'),
                            React.createElement('input', { 
                                type: 'date', 
                                id: 'selectedDate', 
                                required: true,
                                min: getMinDate(),
                                value: selectedDate,
                                onChange: handleDateChange,
                                className: 'w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white'
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { 
                                htmlFor: 'selectedTime', 
                                className: 'block mb-1 font-medium' 
                            }, 'Heure préférée'),
                            React.createElement('select', { 
                                id: 'selectedTime', 
                                required: true,
                                value: selectedTime,
                                onChange: handleTimeChange,
                                className: 'w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 dark:text-white'
                            },
                                React.createElement('option', { value: '' }, 'Sélectionnez une heure'),
                                availableTimes.map((time, index) => 
                                    React.createElement('option', { key: index, value: time }, time)
                                )
                            )
                        )
                    ),
                    selectedDate && selectedTime && 
                    React.createElement('div', { className: 'bg-green-50 dark:bg-green-900 p-3 rounded-lg flex items-center' },
                        React.createElement('svg', { 
                            xmlns: 'http://www.w3.org/2000/svg', 
                            className: 'h-6 w-6 text-green-600 mr-2', 
                            fill: 'none', 
                            viewBox: '0 0 24 24', 
                            stroke: 'currentColor' 
                        },
                            React.createElement('path', { 
                                strokeLinecap: 'round', 
                                strokeLinejoin: 'round', 
                                strokeWidth: 2, 
                                d: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' 
                            })
                        ),
                        React.createElement('p', { className: 'text-green-800 dark:text-green-200' }, 
                            'Le créneau est disponible pour votre réservation'
                        )
                    )
                )
            );
        };

        ReactDOM.render(
            React.createElement(BookingCalendar),
            document.getElementById('react-calendar-container')
        );
    </script>
    
    <script src="js/script.js"></script>
    <script>
    // Logique existante pour le lieu du cours
    document.getElementById('location').addEventListener('change', function() {
        const clientLocationContainer = document.getElementById('clientLocationContainer');
        const clientAddressField = document.getElementById('clientAddress');
        
        if (this.value === 'client') {
            clientLocationContainer.classList.remove('hidden');
            clientAddressField.setAttribute('required', true);
        } else {
            clientLocationContainer.classList.add('hidden');
            clientAddressField.removeAttribute('required');
        }
    });
    
    // Gestion du formulaire de réservation (code existant)
    document.getElementById('reservationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Récupération des données du formulaire
        const formData = new FormData(this);
        
        // URL de votre script Google Apps Script
        const scriptURL = 'VOTRE_URL_DE_SCRIPT_GOOGLE_APPS_SCRIPT';
        
        try {
            // Afficher un indicateur de chargement sur le bouton
            const submitButton = document.getElementById('submitButton');
            const originalButtonText = submitButton.innerHTML;
            submitButton.innerHTML = '<svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Envoi en cours...';
            submitButton.disabled = true;
            
            // Envoi des données via fetch
            fetch(scriptURL, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    // Afficher la notification de succès
                    document.getElementById('successNotification').classList.remove('hidden');
                    
                    // Réinitialiser le formulaire
                    document.getElementById('reservationForm').reset();
                    
                    // Masquer le champ d'adresse client si visible
                    document.getElementById('clientLocationContainer').classList.add('hidden');
                } else {
                    throw new Error('Échec de l\'envoi du formulaire');
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                alert('Une erreur est survenue lors de l\'envoi du formulaire. Veuillez réessayer plus tard.');
            })
            .finally(() => {
                // Restaurer le bouton
                submitButton.innerHTML = originalButtonText;
                submitButton.disabled = false;
            });
            
        } catch (error) {
            console.error('Erreur:', error);
            alert('Une erreur est survenue lors de l\'envoi du formulaire. Veuillez réessayer plus tard.');
        }
    });

    // Gestion de la notification de succès
    document.getElementById('closeNotification').addEventListener('click', function() {
        document.getElementById('successNotification').classList.add('hidden');
    });
    </script>
</body>
</html>
